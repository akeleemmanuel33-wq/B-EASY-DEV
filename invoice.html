<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B-EASY - Invoices</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f6fa;
            color: #333;
            opacity: 0;
            transition: opacity 0.3s;
        }

        body.loaded {
            opacity: 1;
        }

        .header {
            background: white;
            padding: 1rem 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-logout {
            background: #ff4757;
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            background: #ee5a6f;
        }

        .layout {
            display: flex;
            min-height: calc(100vh - 70px);
        }

        .sidebar {
            width: 260px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            padding: 2rem 0;
            transition: all 0.3s;
        }

        .sidebar.mobile-hidden {
            transform: translateX(-100%);
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin: 0.3rem 0;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 2rem;
            color: #666;
            text-decoration: none;
            transition: all 0.3s;
            font-weight: 500;
        }

        .nav-link:hover {
            background: #f8f9fa;
            color: #667eea;
            border-left: 4px solid #667eea;
        }

        .nav-link.active {
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.1) 0%, rgba(255,255,255,0) 100%);
            color: #667eea;
            border-left: 4px solid #667eea;
        }

        .nav-icon {
            font-size: 1.3rem;
        }

        .main-content {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            max-width: 100%;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .page-title {
            font-size: 2rem;
            color: #333;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 0.9rem 1.8rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .invoices-container {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .invoices-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .invoice-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
        }

        .invoice-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e0e0e0;
        }

        .invoice-number {
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
        }

        .invoice-status {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-paid {
            background: #d4edda;
            color: #155724;
        }

        .status-unpaid {
            background: #f8d7da;
            color: #721c24;
        }

        .status-overdue {
            background: #fff3cd;
            color: #856404;
        }

        .invoice-customer {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .invoice-info {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.3rem;
        }

        .invoice-amount {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin-top: 1rem;
        }

        .invoice-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn-small {
            flex: 1;
            padding: 0.6rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .btn-view {
            background: #667eea;
            color: white;
        }

        .btn-view:hover {
            background: #5568d3;
        }

        .btn-delete {
            background: #ff4757;
            color: white;
        }

        .btn-delete:hover {
            background: #ee5a6f;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            overflow-y: auto;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            color: #333;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: #f0f0f0;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.2rem;
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 0.9rem;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .items-section {
            margin: 2rem 0;
        }

        .section-title {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: #333;
        }

        .invoice-items {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .item-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 40px;
            gap: 0.5rem;
            padding: 0.8rem;
            border-bottom: 1px solid #e0e0e0;
            align-items: center;
        }

        .item-row:last-child {
            border-bottom: none;
        }

        .item-header {
            background: #f8f9fa;
            font-weight: 600;
        }

        .item-input {
            padding: 0.6rem;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.95rem;
        }

        .item-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-remove-item {
            background: #ff4757;
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s;
        }

        .btn-remove-item:hover {
            background: #ee5a6f;
            transform: scale(1.1);
        }

        .btn-add-item {
            margin-top: 1rem;
            background: #28a745;
            color: white;
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-add-item:hover {
            background: #218838;
        }

        .invoice-summary {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin-top: 2rem;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            font-size: 1rem;
        }

        .summary-row.total {
            border-top: 2px solid #667eea;
            margin-top: 0.5rem;
            padding-top: 1rem;
            font-size: 1.3rem;
            font-weight: bold;
            color: #667eea;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .btn-cancel {
            background: #f0f0f0;
            color: #666;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-cancel:hover {
            background: #e0e0e0;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            grid-column: 1 / -1;
        }

        .empty-icon {
            font-size: 5rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .empty-title {
            font-size: 1.5rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .empty-text {
            color: #999;
            margin-bottom: 2rem;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem;
            grid-column: 1 / -1;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            display: none;
        }

        .alert.show {
            display: block;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        @media (max-width: 768px) {
            .menu-toggle {
                display: block;
            }

            .sidebar {
                position: fixed;
                left: 0;
                top: 70px;
                height: calc(100vh - 70px);
                z-index: 99;
                box-shadow: 5px 0 20px rgba(0,0,0,0.2);
            }

            .main-content {
                padding: 1rem;
            }

            .page-title {
                font-size: 1.5rem;
            }

            .btn-primary {
                width: 100%;
                justify-content: center;
            }

            .invoices-grid {
                grid-template-columns: 1fr;
            }

            .item-row {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .item-header {
                display: none;
            }

            .item-input {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-left">
            <button class="menu-toggle" onclick="toggleSidebar()">â˜°</button>
            <a href="dashboard.html" class="logo">
                <span>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="currentColor" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
â€ŽÂ Â Â  <path d="M14 21H16M14 21C13.1716 21 12.5 20.3284 12.5 19.5V17L12 17M14 21H10M10 21H8M10 21C10.8284 21 11.5 20.3284 11.5 19.5V17L12 17M12 17V21" />
â€ŽÂ Â Â  <path d="M16 3H8C5.17157 3 3.75736 3 2.87868 3.87868C2 4.75736 2 6.17157 2 9V11C2 13.8284 2 15.2426 2.87868 16.1213C3.75736 17 5.17157 17 8 17H16C18.8284 17 20.2426 17 21.1213 16.1213C22 15.2426 22 13.8284 22 11V9C22 6.17157 22 4.75736 21.1213 3.87868C20.2426 3 18.8284 3 16 3Z" />
â€ŽÂ Â Â  <path d="M16 8L13.5 10.5C13.2274 10.7726 13.0911 10.9089 12.944 10.9818C12.6642 11.1204 12.3358 11.1204 12.056 10.9818C11.9089 10.9089 11.7726 10.7726 11.5 10.5C11.2274 10.2274 11.0911 10.0911 10.944 10.0182C10.6642 9.87955 10.3358 9.87955 10.056 10.0182C9.90894 10.0911 9.77262 10.2274 9.5 10.5L7 13M14 7H15.7143C16.3204 7 16.6234 7 16.8117 7.18829C17 7.37658 17 7.67962 17 8.28571V10" />
â€Ž</svg>
                </span>
                <span>B-Easy</span>
            </a>
        </div>
        <div class="header-right">
            <button class="btn-logout" onclick="handleLogout()">Logout</button>
        </div>
    </header>

    <div class="layout">
        <aside class="sidebar mobile-hidden" id="sidebar">
            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="dashboard.html" class="nav-link">
                            <span class="nav-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="currentColor" fill="none" stroke="#141B34" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
â€ŽÂ Â Â  <path d="M14 16V8C14 7.05719 14 6.58579 13.7071 6.29289C13.4142 6 12.9428 6 12 6C11.0572 6 10.5858 6 10.2929 6.29289C10 6.58579 10 7.05719 10 8V16C10 16.9428 10 17.4142 10.2929 17.7071C10.5858 18 11.0572 18 12 18C12.9428 18 13.4142 18 13.7071 17.7071C14 17.4142 14 16.9428 14 16Z" />
â€ŽÂ Â Â  <path d="M21 9V7C21 6.05719 21 5.58579 20.7071 5.29289C20.4142 5 19.9428 5 19 5C18.0572 5 17.5858 5 17.2929 5.29289C17 5.58579 17 6.05719 17 7V9C17 9.94281 17 10.4142 17.2929 10.7071C17.5858 11 18.0572 11 19 11C19.9428 11 20.4142 11 20.7071 10.7071C21 10.4142 21 9.94281 21 9Z" />
â€ŽÂ Â Â  <path d="M7 14V12C7 11.0572 7 10.5858 6.70711 10.2929C6.41421 10 5.94281 10 5 10C4.05719 10 3.58579 10 3.29289 10.2929C3 10.5858 3 11.0572 3 12V14C3 14.9428 3 15.4142 3.29289 15.7071C3.58579 16 4.05719 16 5 16C5.94281 16 6.41421 16 6.70711 15.7071C7 15.4142 7 14.9428 7 14Z" />
â€ŽÂ Â Â  <path d="M12 21L12 18" />
â€ŽÂ Â Â  <path d="M19 13L19 11" />
â€ŽÂ Â Â  <path d="M12 6L12 3" />
â€ŽÂ Â Â  <path d="M19 5L19 3" />
â€ŽÂ Â Â  <path d="M5 18L5 16" />
â€ŽÂ Â Â  <path d="M5 10L5 8" />
â€Ž</svg>
                            </span>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="customer.html" class="nav-link">
                            <span class="nav-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="currentColor" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"> <path d="M5.52001 3.00001C4.69617 3.00001 4.02832 3.6718 4.02832 4.50049C4.02832 5.32918 4.69617 6.00097 5.52001 6.00097C6.34385 6.00097 7.0117 5.32918 7.0117 4.50049C7.0117 3.6718 6.34385 3.00001 5.52001 3.00001Z" /> <path d="M18.4821 21.0002H16.7038C16.4972 21.0002 16.2898 20.97 16.1001 20.8852C15.4826 20.6091 15.1693 20.2446 15.0233 20.0165C14.9402 19.8867 14.9521 19.7215 15.0422 19.5969C15.7576 18.6081 17.4164 18.0108 18.4821 18.0108M18.4852 21.0002H20.2635C20.4701 21.0002 20.6775 20.97 20.8672 20.8852C21.4847 20.6091 21.798 20.2446 21.944 20.0165C22.0271 19.8867 22.0153 19.7215 21.9251 19.5969C21.2097 18.6081 19.5509 18.0108 18.4852 18.0108" /> <path d="M5.51485 11.4924H3.73649C3.52995 11.4924 3.32254 11.4622 3.13284 11.3774C2.51533 11.1013 2.20203 10.7367 2.05602 10.5087C1.97294 10.3789 1.98477 10.2136 2.07491 10.0891C2.79035 9.10026 4.44914 8.50299 5.51485 8.50294M5.51789 11.4924H7.29625C7.50279 11.4924 7.7102 11.4622 7.8999 11.3774C8.51741 11.1013 8.83071 10.7367 8.97672 10.5087C9.0598 10.3789 9.04797 10.2136 8.95783 10.0891C8.24239 9.10026 6.5836 8.50299 5.51789 8.50294" /> <path d="M11.4868 4.00001C14.2995 4.00001 16.7004 4.00001 17.5742 4.87897C18.448 5.75793 18.448 6.67243 18.448 9.50177L16.4591 8.50145" /> <path d="M11.9842 20.0057C9.1714 20.0057 6.77057 20.0057 5.89676 19.1267C5.02295 18.2477 5.02295 17.3332 5.02295 14.5039L7.01187 15.5042" /> <path d="M18.4477 12.5029C17.6239 12.5029 16.9561 13.1748 16.9561 14.0034C16.9561 14.8321 17.6239 15.5039 18.4477 15.5039C19.2716 15.5039 19.9394 14.8321 19.9394 14.0034C19.9394 13.1748 19.2716 12.5029 18.4477 12.5029Z" /> </svg>
                            </span>
                            <span>Customers</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link active">
                            <span class="nav-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="currentColor" fill="none" stroke="#141B34" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
â€ŽÂ Â Â  <path d="M14.4998 13.501C14.4998 14.8817 13.3805 16.001 11.9998 16.001C10.619 16.001 9.49976 14.8817 9.49976 13.501C9.49976 12.1203 10.619 11.001 11.9998 11.001C13.3805 11.001 14.4998 12.1203 14.4998 13.501Z" />
â€ŽÂ Â Â  <path d="M17.5 6.5498C19.1831 6.66255 20.3941 6.94811 21.1329 7.17709C21.6756 7.34528 22 7.85966 22 8.42782V18.1831C22 19.2982 20.7719 20.1372 19.6762 19.9303C18.7361 19.7528 17.5107 19.6101 16 19.6101C11.2491 19.6101 10.1096 21.4158 3.1448 19.88C2.47265 19.7318 2 19.1273 2 18.439V8.42193C2 7.44607 2.92079 6.73443 3.87798 6.92437C4.86572 7.12037 5.72897 7.24475 6.5 7.3151" />
â€ŽÂ Â Â  <path d="M2 10.501C3.95133 10.501 5.70483 8.90605 5.92901 7.25514M18.5005 7.00098C18.5005 9.04062 20.2655 10.97 22 10.97M22 16.501C20.1009 16.501 18.2601 17.8112 18.102 19.5993M6.00049 19.9971C6.00049 17.7879 4.20963 15.9971 2.00049 15.9971" />
â€ŽÂ Â Â  <path d="M12 7.50098V3.50098M15 7.50098V5.50098M9 7.50098V5.50098" />
â€Ž</svg>
                            </span>
                            <span>Invoices</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="record.html" class="nav-link">
                            <span class="nav-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="currentColor" fill="none" stroke="#141B34" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
â€ŽÂ Â Â  <path d="M14.4998 13.501C14.4998 14.8817 13.3805 16.001 11.9998 16.001C10.619 16.001 9.49976 14.8817 9.49976 13.501C9.49976 12.1203 10.619 11.001 11.9998 11.001C13.3805 11.001 14.4998 12.1203 14.4998 13.501Z" />
â€ŽÂ Â Â  <path d="M17.5 6.5498C19.1831 6.66255 20.3941 6.94811 21.1329 7.17709C21.6756 7.34528 22 7.85966 22 8.42782V18.1831C22 19.2982 20.7719 20.1372 19.6762 19.9303C18.7361 19.7528 17.5107 19.6101 16 19.6101C11.2491 19.6101 10.1096 21.4158 3.1448 19.88C2.47265 19.7318 2 19.1273 2 18.439V8.42193C2 7.44607 2.92079 6.73443 3.87798 6.92437C4.86572 7.12037 5.72897 7.24475 6.5 7.3151" />
â€ŽÂ Â Â  <path d="M2 10.501C3.95133 10.501 5.70483 8.90605 5.92901 7.25514M18.5005 7.00098C18.5005 9.04062 20.2655 10.97 22 10.97M22 16.501C20.1009 16.501 18.2601 17.8112 18.102 19.5993M6.00049 19.9971C6.00049 17.7879 4.20963 15.9971 2.00049 15.9971" />
â€ŽÂ Â Â  <path d="M12 7.50098V3.50098M15 7.50098V5.50098M9 7.50098V5.50098" />
â€Ž</svg>
                            </span>
                            <span>Sales</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="report.html" class="nav-link">
                            <span class="nav-icon">
                                â€Ž<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="currentColor" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
â€ŽÂ Â Â  <path d="M2 21H22" />
â€ŽÂ Â Â  <path d="M4 18L4 15" />
â€ŽÂ Â Â  <path d="M8 14L8 9" />
â€ŽÂ Â Â  <path d="M12 11L12 9" />
â€ŽÂ Â Â  <path d="M16 11L16 5" />
â€ŽÂ Â Â  <path d="M20 5L20 3" />
â€Ž</svg>
                            </span>
                            <span>Analytics</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="setting.html" class="nav-link">
                            <span class="nav-icon">
                                â€Ž<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="currentColor" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round">
â€ŽÂ Â Â  <path d="M21.3175 7.14139L20.8239 6.28479C20.4506 5.63696 20.264 5.31305 19.9464 5.18388C19.6288 5.05472 19.2696 5.15664 18.5513 5.36048L17.3311 5.70418C16.8725 5.80994 16.3913 5.74994 15.9726 5.53479L15.6357 5.34042C15.2766 5.11043 15.0004 4.77133 14.8475 4.37274L14.5136 3.37536C14.294 2.71534 14.1842 2.38533 13.9228 2.19657C13.6615 2.00781 13.3143 2.00781 12.6199 2.00781H11.5051C10.8108 2.00781 10.4636 2.00781 10.2022 2.19657C9.94085 2.38533 9.83106 2.71534 9.61149 3.37536L9.27753 4.37274C9.12465 4.77133 8.84845 5.11043 8.48937 5.34042L8.15249 5.53479C7.73374 5.74994 7.25259 5.80994 6.79398 5.70418L5.57375 5.36048C4.85541 5.15664 4.49625 5.05472 4.17867 5.18388C3.86109 5.31305 3.67445 5.63696 3.30115 6.28479L2.80757 7.14139C2.45766 7.74864 2.2827 8.05227 2.31666 8.37549C2.35061 8.69871 2.58483 8.95918 3.05326 9.48012L4.0843 10.6328C4.3363 10.9518 4.51521 11.5078 4.51521 12.0077C4.51521 12.5078 4.33636 13.0636 4.08433 13.3827L3.05326 14.5354C2.58483 15.0564 2.35062 15.3168 2.31666 15.6401C2.2827 15.9633 2.45766 16.2669 2.80757 16.8741L3.30114 17.7307C3.67443 18.3785 3.86109 18.7025 4.17867 18.8316C4.49625 18.9608 4.85542 18.8589 5.57377 18.655L6.79394 18.3113C7.25263 18.2055 7.73387 18.2656 8.15267 18.4808L8.4895 18.6752C8.84851 18.9052 9.12464 19.2442 9.2775 19.6428L9.61149 20.6403C9.83106 21.3003 9.94085 21.6303 10.2022 21.8191C10.4636 22.0078 10.8108 22.0078 11.5051 22.0078H12.6199C13.3143 22.0078 13.6615 22.0078 13.9228 21.8191C14.1842 21.6303 14.294 21.3003 14.5136 20.6403L14.8476 19.6428C15.0004 19.2442 15.2765 18.9052 15.6356 18.6752L15.9724 18.4808C16.3912 18.2656 16.8724 18.2055 17.3311 18.3113L18.5513 18.655C19.2696 18.8589 19.6288 18.9608 19.9464 18.8316C20.264 18.7025 20.4506 18.3785 20.8239 17.7307L21.3175 16.8741C21.6674 16.2669 21.8423 15.9633 21.8084 15.6401C21.7744 15.3168 21.5402 15.0564 21.0718 14.5354L20.0407 13.3827C19.7887 13.0636 19.6098 12.5078 19.6098 12.0077C19.6098 11.5078 19.7888 10.9518 20.0407 10.6328L21.0718 9.48012C21.5402 8.95918 21.7744 8.69871 21.8084 8.37549C21.8423 8.05227 21.6674 7.74864 21.3175 7.14139Z" />
â€ŽÂ Â Â  <path d="M15.5195 12C15.5195 13.933 13.9525 15.5 12.0195 15.5C10.0865 15.5 8.51953 13.933 8.51953 12C8.51953 10.067 10.0865 8.5 12.0195 8.5C13.9525 8.5 15.5195 10.067 15.5195 12Z" />
â€Ž</svg>
                            </span>
                            <span>Settings</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <div id="alertBox" class="alert"></div>

            <div class="page-header">
                <h1 class="page-title">Invoices</h1>
                <button class="btn-primary" onclick="openCreateModal()">
                    <span>
                        â€Ž<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="currentColor" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
â€ŽÂ Â Â  <path d="M22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12Z" />
â€ŽÂ Â Â  <path d="M12 8V16M16 12H8" />
â€Ž</svg>
                    </span>
                    <span>Create Invoice</span>
                </button>
            </div>

            <div class="invoices-container">
                <div id="invoicesGrid" class="invoices-grid">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Create Invoice Modal -->
    <div id="invoiceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Create Invoice</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <form id="invoiceForm" onsubmit="handleSubmit(event)">
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Customer *</label>
                            <select class="form-select" id="customerId" required>
                                <option value="">Select Customer</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Due Date</label>
                            <input type="date" class="form-input" id="dueDate">
                        </div>
                    </div>

                    <div class="items-section">
                        <h3 class="section-title">Invoice Items</h3>
                        <div class="invoice-items">
                            <div class="item-row item-header">
                                <div>Description</div>
                                <div>Quantity</div>
                                <div>Price (â‚¦)</div>
                                <div>Total</div>
                                <div></div>
                            </div>
                            <div id="itemsContainer"></div>
                        </div>
                        <button type="button" class="btn-add-item" onclick="addItem()">+ Add Item</button>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Notes</label>
                        <input type="text" class="form-input" id="invoiceNotes" placeholder="Payment terms, additional info...">
                    </div>

                    <div class="invoice-summary">
                        <div class="summary-row">
                            <span>Subtotal:</span>
                            <span id="subtotal">â‚¦0</span>
                        </div>
                        <div class="summary-row total">
                            <span>Total:</span>
                            <span id="totalAmount">â‚¦0</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-cancel" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Create Invoice</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
         const SUPABASE_URL = 'https://afyfhpvekuikotdykuql.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFmeWZocHZla3Vpa290ZHlrdXFsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMzE0NzgsImV4cCI6MjA4MzcwNzQ3OH0.L1CV71lO_7EDQzzNSzXknmh8T8xb3b9iItMUd8Ih4Zk';
        
        const supabaseClient = window.supabase ? window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY) : null;

        let currentUserId = null;
        let allInvoices = [];
        let allCustomers = [];
        let invoiceCounter = 1;

        async function init() {
            if (!supabaseClient) {
                window.location.href = 'login.html';
                return;
            }

            try {
                const { data: { session } } = await supabaseClient.auth.getSession();
                
                if (!session) {
                    window.location.href = 'login.html';
                    return;
                }

                currentUserId = session.user.id;
                await loadCustomers();
                await loadInvoices();
                document.body.classList.add('loaded');
                
            } catch (error) {
                console.error('Auth error:', error);
                window.location.href = 'login.html';
            }
        }

        async function loadCustomers() {
            try {
                const { data, error } = await supabaseClient
                    .from('customers')
                    .select('*')
                    .eq('user_id', currentUserId)
                    .order('name');

                if (error) throw error;

                allCustomers = data || [];
                populateCustomerDropdown();
                
            } catch (error) {
                console.error('Error loading customers:', error);
            }
        }

        function populateCustomerDropdown() {
            const select = document.getElementById('customerId');
            select.innerHTML = '<option value="">Select Customer</option>';
            
            allCustomers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                option.textContent = customer.name;
                select.appendChild(option);
            });
        }

        async function loadInvoices() {
            try {
                const { data, error } = await supabaseClient
                    .from('invoices')
                    .select('*, customers(name)')
                    .eq('user_id', currentUserId)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                allInvoices = data || [];
                
                if (allInvoices.length > 0) {
                    const lastInvoice = allInvoices[0];
                    const lastNumber = parseInt(lastInvoice.invoice_number.split('-')[1]);
                    invoiceCounter = lastNumber + 1;
                }
                
                renderInvoices(allInvoices);
                
            } catch (error) {
                console.error('Error loading invoices:', error);
                showAlert('Error loading invoices: ' + error.message, 'error');
            }
        }

        function renderInvoices(invoices) {
            const grid = document.getElementById('invoicesGrid');
            
            if (invoices.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ðŸ§¾</div>
                        <h3 class="empty-title">No invoices yet</h3>
                        <p class="empty-text">Create your first invoice to get started!</p>
                        <button class="btn-primary" onclick="openCreateModal()">
                            <span>
                                â€Ž<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="currentColor" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
â€ŽÂ Â Â  <path d="M22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12Z" />
â€ŽÂ Â Â  <path d="M12 8V16M16 12H8" />
â€Ž</svg>
                            </span>
                            <span>Create First Invoice</span>
                        </button>
                    </div>
                `;
                return;
            }

            grid.innerHTML = invoices.map(invoice => {
                const customerName = invoice.customers?.name || 'Unknown Customer';
                const amount = parseFloat(invoice.amount || 0);
                const status = invoice.status || 'unpaid';
                const dueDate = invoice.due_date ? new Date(invoice.due_date).toLocaleDateString() : 'No due date';
                
                let statusClass = 'status-unpaid';
                if (status === 'paid') statusClass = 'status-paid';
                if (status === 'overdue') statusClass = 'status-overdue';
                
                return `
                    <div class="invoice-card">
                        <div class="invoice-header">
                            <div class="invoice-number">${invoice.invoice_number}</div>
                            <span class="invoice-status ${statusClass}">${status.toUpperCase()}</span>
                        </div>
                        <div class="invoice-customer">${customerName}</div>
                        <div class="invoice-info">
                         â€Ž<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="currentColor" fill="none" stroke="#141B34" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
â€ŽÂ Â Â  <path d="M16 2V6M8 2V6" />
â€ŽÂ Â Â  <path d="M13 4H11C7.22876 4 5.34315 4 4.17157 5.17157C3 6.34315 3 8.22876 3 12V14C3 17.7712 3 19.6569 4.17157 20.8284C5.34315 22 7.22876 22 11 22H13C16.7712 22 18.6569 22 19.8284 20.8284C21 19.6569 21 17.7712 21 14V12C21 8.22876 21 6.34315 19.8284 5.17157C18.6569 4 16.7712 4 13 4Z" />
â€ŽÂ Â Â  <path d="M3 10H21" />
â€ŽÂ Â Â  <path d="M11.9955 14H12.0045M11.9955 18H12.0045M15.991 14H16M8 14H8.00897M8 18H8.00897" />
â€Ž</svg>   
                             Due: ${dueDate}</div>
                        <div class="invoice-amount">â‚¦${amount.toLocaleString()}</div>
                        <div class="invoice-actions">
                            <button class="btn-small btn-view" onclick="downloadInvoice('${invoice.id}')">Download PDF</button>
                            <button class="btn-small btn-delete" onclick="deleteInvoice('${invoice.id}')">Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function openCreateModal() {
            if (allCustomers.length === 0) {
                showAlert('Please add customers first before creating invoices!', 'error');
                setTimeout(() => {
                    window.location.href = 'customers.html';
                }, 2000);
                return;
            }

            document.getElementById('invoiceModal').classList.add('show');
            document.getElementById('itemsContainer').innerHTML = '';
            addItem();
            addItem();
        }

        function closeModal() {
            document.getElementById('invoiceModal').classList.remove('show');
            document.getElementById('invoiceForm').reset();
        }

        function addItem() {
            const container = document.getElementById('itemsContainer');
            const itemId = Date.now();
            
            const itemRow = document.createElement('div');
            itemRow.className = 'item-row';
            itemRow.id = `item-${itemId}`;
            itemRow.innerHTML = `
                <input type="text" class="item-input" placeholder="Item description" data-field="description" onchange="calculateTotal()">
                <input type="number" class="item-input" placeholder="1" min="1" value="1" data-field="quantity" onchange="calculateTotal()">
                <input type="number" class="item-input" placeholder="0.00" min="0" step="0.01" data-field="price" onchange="calculateTotal()">
                <input type="text" class="item-input" readonly value="â‚¦0" data-field="total">
                <button type="button" class="btn-remove-item" onclick="removeItem('${itemId}')">Ã—</button>
            `;
            
            container.appendChild(itemRow);
        }

        function removeItem(itemId) {
            const item = document.getElementById(`item-${itemId}`);
            if (item) {
                item.remove();
                calculateTotal();
            }
        }

        function calculateTotal() {
            const items = document.querySelectorAll('#itemsContainer .item-row');
            let subtotal = 0;

            items.forEach(item => {
                const quantity = parseFloat(item.querySelector('[data-field="quantity"]').value) || 0;
                const price = parseFloat(item.querySelector('[data-field="price"]').value) || 0;
                const itemTotal = quantity * price;
                
                item.querySelector('[data-field="total"]').value = `â‚¦${itemTotal.toLocaleString()}`;
                subtotal += itemTotal;
            });

            document.getElementById('subtotal').textContent = `â‚¦${subtotal.toLocaleString()}`;
            document.getElementById('totalAmount').textContent = `â‚¦${subtotal.toLocaleString()}`;
        }

        async function handleSubmit(event) {
            event.preventDefault();

            const customerId = document.getElementById('customerId').value;
            const dueDate = document.getElementById('dueDate').value;
            const notes = document.getElementById('invoiceNotes').value;

            if (!customerId) {
                showAlert('Please select a customer', 'error');
                return;
            }

            const items = [];
            const itemRows = document.querySelectorAll('#itemsContainer .item-row');
            
            itemRows.forEach(row => {
                const description = row.querySelector('[data-field="description"]').value;
                const quantity = parseFloat(row.querySelector('[data-field="quantity"]').value);
                const price = parseFloat(row.querySelector('[data-field="price"]').value);
                
                if (description && quantity && price) {
                    items.push({
                        description,
                        quantity,
                        price,
                        total: quantity * price
                    });
                }
            });

            if (items.length === 0) {
                showAlert('Please add at least one item', 'error');
                return;
            }

            const totalAmount = items.reduce((sum, item) => sum + item.total, 0);
            const invoiceNumber = `INV-${String(invoiceCounter).padStart(3, '0')}`;

            const invoiceData = {
                user_id: currentUserId,
                customer_id: customerId,
                invoice_number: invoiceNumber,
                amount: totalAmount,
                status: 'unpaid',
                due_date: dueDate || null,
                items: items,
                notes: notes || null
            };

            try {
                const { error } = await supabaseClient
                    .from('invoices')
                    .insert([invoiceData]);

                if (error) throw error;

                showAlert('Invoice created successfully!', 'success');
                invoiceCounter++;
                closeModal();
                await loadInvoices();
                
            } catch (error) {
                console.error('Error creating invoice:', error);
                showAlert('Error: ' + error.message, 'error');
            }
        }

        async function downloadInvoice(invoiceId) {
            try {
                const invoice = allInvoices.find(inv => inv.id === invoiceId);
                if (!invoice) return;

                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                doc.setFontSize(20);
                doc.text('INVOICE', 105, 20, { align: 'center' });

                doc.setFontSize(12);
                doc.text(`Invoice #: ${invoice.invoice_number}`, 20, 40);
                doc.text(`Date: ${new Date(invoice.created_at).toLocaleDateString()}`, 20, 50);
                
                if (invoice.due_date) {
                    doc.text(`Due Date: ${new Date(invoice.due_date).toLocaleDateString()}`, 20, 60);
                }

                doc.text('Bill To:', 20, 80);
                doc.setFontSize(10);
                doc.text(invoice.customers?.name || 'Customer', 20, 88);

                doc.setFontSize(10);
                let yPos = 110;
                doc.text('Description', 20, yPos);
                doc.text('Qty', 100, yPos);
                doc.text('Price', 130, yPos);
                doc.text('Total', 170, yPos);
                doc.line(20, yPos + 2, 190, yPos + 2);

                yPos += 10;
                const items = invoice.items || [];
                items.forEach(item => {
                    doc.text(item.description.substring(0, 30), 20, yPos);
                    doc.text(String(item.quantity), 100, yPos);
                    doc.text(`â‚¦${item.price.toLocaleString()}`, 130, yPos);
                    doc.text(`â‚¦${item.total.toLocaleString()}`, 170, yPos);
                    yPos += 8;
                });

                doc.line(20, yPos, 190, yPos);
                yPos += 10;
                doc.setFontSize(12);
                doc.text(`Total: â‚¦${parseFloat(invoice.amount).toLocaleString()}`, 170, yPos, { align: 'right' });

                if (invoice.notes) {
                    yPos += 20;
                    doc.setFontSize(10);
                    doc.text('Notes:', 20, yPos);
                    doc.text(invoice.notes, 20, yPos + 8);
                }

                doc.save(`${invoice.invoice_number}.pdf`);
                showAlert('Invoice downloaded successfully!', 'success');
                
            } catch (error) {
                console.error('Error downloading invoice:', error);
                showAlert('Error downloading invoice', 'error');
            }
        }

        async function deleteInvoice(invoiceId) {
            const invoice = allInvoices.find(inv => inv.id === invoiceId);
            if (!invoice) return;

            if (!confirm(`Are you sure you want to delete invoice ${invoice.invoice_number}?`)) {
                return;
            }

            try {
                const { error } = await supabaseClient
                    .from('invoices')
                    .delete()
                    .eq('id', invoiceId);

                if (error) throw error;

                showAlert('Invoice deleted successfully!', 'success');
                await loadInvoices();
                
            } catch (error) {
                console.error('Error deleting invoice:', error);
                showAlert('Error: ' + error.message, 'error');
            }
        }

        function showAlert(message, type = 'success') {
            const alertBox = document.getElementById('alertBox');
            alertBox.className = `alert alert-${type} show`;
            alertBox.textContent = message;
            
            setTimeout(() => {
                alertBox.classList.remove('show');
            }, 5000);
        }

        async function handleLogout() {
            if (!supabaseClient) return;
            if (!confirm('Are you sure you want to logout?')) return;

            try {
                await supabaseClient.auth.signOut();
                window.location.href = 'login.html';
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('mobile-hidden');
        }

        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.querySelector('.menu-toggle');
            
            if (window.innerWidth <= 768) {
                if (!sidebar.contains(event.target) && !menuToggle.contains(event.target)) {
                    sidebar.classList.add('mobile-hidden');
                }
            }
        });

        document.getElementById('invoiceModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeModal();
            }
        });

        function showComingSoon() {
            alert('This feature is coming soon! ðŸš€');
        }

        init();
    </script>
</body>
</html>